<!DOCTYPE html>  <html> <head>   <title>interview-problems-dependency-manager.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> <script type="text/javascript">   if (window.location.hostname == '6a68.net') {         var _gaq = _gaq || [];       _gaq.push(['_setAccount', 'UA-32602307-1']);       _gaq.push(['_trackPageview']);        (function() {         var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;         ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';         var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);       })();     }  </script> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="code-equals-data-equals-code.html">                 code-equals-data-equals-code.js               </a>                                           <a class="source" href="frontend-architecture-patterns.html">                 frontend-architecture-patterns.js               </a>                                           <a class="source" href="functional-programming.html">                 functional-programming.js               </a>                                           <a class="source" href="index.html">                 index.js               </a>                                           <a class="source" href="interview-problems-dependency-manager.html">                 interview-problems-dependency-manager.js               </a>                                           <a class="source" href="meebo-jquery.html">                 meebo-jquery.js               </a>                                           <a class="source" href="reentrant-exceptions.html">                 reentrant-exceptions.js               </a>                                           <a class="source" href="rsvp.html">                 rsvp.js               </a>                                           <a class="source" href="theres-a-bluebird-in-my-heart.html">                 theres-a-bluebird-in-my-heart.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h2>Interview problem: build a dependency manager in JS</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h3>like I said on the main page, everything on this site is a draft, but this is <em>extra drafty</em>.</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>I've been doing <a href="http://allthingsd.com/20120604/confirmed-google-grabs-meebo/">a lot of interviewing lately</a>. This has gotten me thinking about
what makes a problem really good for an hour-long coding session; this one popped
into my head in the shower today.</p>

<p>Most people have used requireJS or similar dependency managers in YUI, Dojo, and Closure
(among others) to load class dependencies in the right order. Building a tiny version of
such a library is a great front-end coding problem because:</p>

<ul>
<li>it requires having some experience and common sense with APIs (although you could
give someone the API as a starting point);</li>
<li>it provides an opportunity to discuss the use cases and edge cases around such
a library, like loading different dependencies for handset, tablet, and desktop;</li>
<li>it requires knowing some computer science (how to check if a graph is acyclic; how
to topologically sort a DAG), yet is a practical enough problem that someone with
little formal CS chops, but solid coding experience, could probably muscle through
and hopefully have fun talking it out.</li>
<li>if someone does know CS, you can take the finished product and see if they can think
of some similar applications (one that's feasible in JS would be a priority queue
used to schedule work for a set of Workers).</li>
</ul>

<p>Beyond getting an implementation working, there are a zillion different directions
you could go, if you have extra time; just talking through the options might be
revealing and useful.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>The solution starts by modeling class dependencies as a graph with a node for
every class, and, for each dependency relation, a directed edge that points from a
class to its dependency.</p>

<p>If there are no circular dependencies, then you've got a directed acyclic graph, or DAG,
and flattening a DAG into a list is known as a topological sort.</p>

<p>The references I'll be using to check my work (since I'm sharing this ;-) are Skeina's 
Algo Design Manual, the coverage of topological sort in CLR, and maybe a peek at the
source code for requireJS (or other big libraries that handle class/module dependencies).</p>

<p>By the way, I didn't go to school for computer science. Reading (and re-reading, and re-reading) parts of
<a href="http://www.amazon.com/Algorithm-Design-Manual-Steven-Skiena/dp/1848000693/">Skeina</a>, <a href="http://www.amazon.com/Introduction-Algorithms-Thomas-H-Cormen/dp/0262033844/">CLR</a>, and <a href="http://mitpress.mit.edu/sicp/">SICP</a> taught me what I know; anyone can do it, it just takes time and energy.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>So...what would you have to do to solve this problem? Here are my thoughts for starters:</p>

<ul>
<li>decide how to represent dependency links between classes</li>
<li>write a bit of code to register dependencies for each class: 
"require(className)" or "require(className, deps)"</li>
<li>the core of the problem: flatten the dependency graph into a list of dependencies:
<ul><li>start by checking the in-degree of each node (the number of dependencies a class has).</li>
<li>nodes with in-degree zero (classes with no dependencies) are leaf nodes; we should use these
as starting points for each DFS.</li>
<li>we'll keep a global exit counter so that, if we have more than one leaf node, we will
be able to run a DFS from each, and still have a correct global loading order.</li>
<li>as each node is exited by DFS, push it onto an array.</li>
<li>after DFS visits every node in the graph, you'll have a complete list of dependencies
in the array; you can just iterate over it to list off classes in sorted order.</li></ul></li>
<li>what's space and time complexity? 
<ul><li>O(V+E) in time, because DFS is O(V+E) and, assuming Array.push() is O(1), pushing all
nodes onto the array costs O(V) time.</li>
<li>O(V^2) in space to store adjacency matrix, O(E) space to store as adjacency list,
O(V) for the output array -- looks like O(V^2) overall. (Need to think more about this.)</li></ul></li>
<li>what if you run into circular dependencies?
<ul><li>you want to remove just enough edges to make the graph acyclic; see discussion below.</li>
<li>note that removing the minimal set of edges is an NP-complete problem (so, a nice
opportunity to talk about complexity).</li></ul></li>
<li>what if a dependency is missing from the graph?
<ul><li>you'll have to remove everything that depends on it.</li>
<li>this can be done by adding the missing node, flipping the edge direction, 
doing DFS downward from the missing node, and removing all encountered nodes
from the graph. Seems doable in at worst O(V+E) time (if the root is missing).</li></ul></li>
<li>what if you want to specify chunked dependencies as modules, which aren't actually
a class, but just a list of classes?
<ul><li>I haven't thought this through, but seems like you could tweak your representation</li></ul></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h3>a sketch of a solution</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Suppose that: </p>

<ul>
<li>myclass -> jquery, jquery.cookie, and underscore.js, and</li>
<li>everything depends on some base class.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>We might start by assuming we have a graph represented by having a list of dependencies
for each class, which is an adjacency list representation:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">adjList</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;myclass&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;jquery&#39;</span><span class="p">,</span> <span class="s1">&#39;jquery.cookie&#39;</span><span class="p">,</span> <span class="s1">&#39;underscore&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">],</span> 
    <span class="s1">&#39;jquery&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">],</span> 
    <span class="s1">&#39;jquery.cookie&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;jquery&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">],</span>
    <span class="s1">&#39;underscore&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;jquery&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">]</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>A matrix view could also work, where we'd have the full list of classes along the X and Y 
directions, with an entry in a cell if one class depended on the other.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>this object maps class names to array entries in the matrix.
I wish I knew of a more elegant approach, but whatever, just come back to this.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">matrixKeys</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;base&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;jquery&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> 
    <span class="s1">&#39;jquery.cookie&#39;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;underscore&#39;</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> 
    <span class="s1">&#39;myclass&#39;</span><span class="o">:</span> <span class="mi">4</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">matrixValues</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="s1">&#39;jquery&#39;</span><span class="p">,</span> <span class="s1">&#39;jquery.cookie&#39;</span><span class="p">,</span> <span class="s1">&#39;underscore&#39;</span><span class="p">,</span> <span class="s1">&#39;myclass&#39;</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>our matrix is an array of arrays, where the ith array has a 1 for each jth thing it depends on.</p>

<p>so, the first array is empty, because base depends on nothing.
the second array has a 1 in the zeroth place, because jquery depends on base.
the third array has two 1s, because jquery.cookie depends on base and jquery.
and so on.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">adjMatrix</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>adjMatrix[0] has non-zero entries for any of the dependencies for base.
you could write this as adjMatrix[matrixKeys['base']].</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">dependsOn</span><span class="p">(</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">deps</span> <span class="o">=</span> <span class="nx">adjMatrix</span><span class="p">.</span><span class="nx">classname</span><span class="p">,</span>
        <span class="nx">classes</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">deps</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">deps</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">classes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">matrixValues</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">classes</span><span class="p">;</span>
<span class="p">}</span> </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>on the other hand, if we want to measure the number of classes that depend on
a given class, or its in-degree, we'll go vertically down the matrix:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">dependentOn</span><span class="p">(</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">classes</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">j</span> <span class="o">=</span> <span class="nx">matrixKeys</span><span class="p">[</span><span class="nx">className</span><span class="p">];</span> 
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">adjMatrix</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">adjMatrix</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">classes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">matrixValues</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">classes</span><span class="p">;</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>alright, now we can get the in-degree for every node in the graph by running 
dependentOn(node). we'll then call DFS on nodes with in-degree zero.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>this function will take a list of node names in the graph and return their in-degree.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">indegree</span><span class="p">(</span><span class="nx">graph</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">degrees</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">node</span> <span class="k">in</span> <span class="nx">graph</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">degrees</span><span class="p">[</span><span class="nx">node</span><span class="p">]</span> <span class="o">=</span> <span class="nx">dependentOn</span><span class="p">(</span><span class="nx">node</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">degrees</span><span class="p">;</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>alright, assuming we know which nodes we want to pass to DFS, let's make a global
exit counter as the length of the list of visited nodes.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">visited</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>and, let's DFS, incrementing the exit counter as each node is exited. To keep
track of the exit times, we can fire an event or callback, or just operate on
the data structure directly.</p>

<p>because javascript can't optimize tail calls, we should use an explicit stack, or
else even modest recursion will blow the stack. Again, this is an opportunity for
a conversation.</p>

<p>this could be cleaner and more general, but it looks like it works?</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">visited</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">dependencies</span> <span class="o">=</span> <span class="nx">dependsOn</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span>
        <span class="nx">dependency</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">dependency</span> <span class="k">in</span> <span class="nx">dependencies</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">dependency</span> <span class="k">in</span> <span class="nx">visited</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span> <span class="c1">// already visited, something&#39;s gone wrong. todo, handle this.</span>
        <span class="p">}</span>
        <span class="nx">dfs</span><span class="p">(</span><span class="nx">dependency</span><span class="p">,</span> <span class="nx">visited</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">visited</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>once you've run dfs on a node, you've pushed all its dependencies, in exit order,
onto the visited array.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>so, calling dfs on every node with in-degree 0 is our topological sort.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">topologicalSort</span><span class="p">(</span><span class="nx">graph</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">indegrees</span> <span class="o">=</span> <span class="nx">indegree</span><span class="p">(</span><span class="nx">graph</span><span class="p">),</span>
        <span class="nx">leaves</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">indegrees</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">indegrees</span><span class="p">[</span><span class="nx">node</span><span class="p">])</span> <span class="p">{</span> <span class="nx">leaves</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">visited</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">leaf</span> <span class="k">in</span> <span class="nx">leaves</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dfs</span><span class="p">(</span><span class="nx">leaf</span><span class="p">,</span> <span class="nx">visited</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">visited</span><span class="p">;</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>stuff not yet covered:</p>

<ul>
<li>talking about the register(className, depsList) -- maybe better to just provide this API</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h3>here's a bunch of unsorted draft discussion.</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>implement the DFS.</p>

<p>since the finish time increments for every item, we can just insert nodes
into an array where the ith entry has finish time i.</p>

<p>the most idiomatic way to handle entry/exit events seems to be publishing
an event when that happens. Let's assume we have a pubsub system in place,
and we'll just call fire(event, data) to notify Observers. This lets us
split up our code cleanly. (You could use callbacks as well, or just hack
the DFS code and the exit time handler code in one function body. So, this
is a chance to talk about the tradeoffs between using events and callbacks.)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Registrar</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dfs</span><span class="p">(</span><span class="nx">graph</span><span class="p">)</span> <span class="p">{</span>
    
    
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>So, how would we check if there were circular dependencies?</p>

<p>We'd have cycles in the dependency graph.</p>

<p>And how would we check for cycles in a directed graph? </p>

<ul>
<li>For each node in the graph,
<ul><li>Mark every node as unvisited</li>
<li>Do a depth-first search, marking nodes as visited as we go</li>
<li>If you hit a node marked visited, you found a cycle</li></ul></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>If you do find a circular dependency, how do you handle it?</p>

<p>You don't really want to bail out and refuse to load the page--you want to
 try to continue, by removing the smallest number of edges to make the graph
 not circular. Skeina refers to this as the 'feedback vertex set' problem,
 and he refers to the special case of reducing a graph to a DAG as the 'maximum 
 acyclic subgraph' problem.</p>

<p>This is super cool stuff to discuss in an interview context, but definitely
 falls in the realm of extra-extra credit. Finding a feedback edge or vertex
 set is an NP-complete problem (hence, here's a chance to talk about complexity
 theory); the best you could hope for would be to find a good solution that still
 deletes more edges than is necessary. </p>

<p>The simplest heuristic is, whenever DFS encounters an already-visited node, just
 delete that edge. This is something you could actually get done in just a couple
 of minutes of whiteboarding, or at least talk through pretty quickly.</p>

<p>If you look at this as a maximum acyclic subgraph problem, there's actually a
 really simple algorithm that guarantees you a solution no worse than twice as
 large as the optimal set. (Skeina's description is unclear; todo flesh this out)</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> <div id="disqus_thread" style="max-width: 500px"></div>         <script>             var disqus_shortname = '6a68';              (function() {                 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;                 dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';                 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);             })();         </script>         <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>         <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a> </body> </html> 